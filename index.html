<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>七夕快乐</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link rel="stylesheet" type="text/css" href="pageA.css">
    <link rel="stylesheet" type="text/css" href="pageB.css">
    <link rel="stylesheet" type="text/css" href="pageC.css">
    <script src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.transit.js"></script>
    
    <style type="text/css">
        
    </style>
</head>

<body>
    <div id='content'>
        <ul class='content-wrap'>
            <!-- 第一副画面 -->
            <li>
            	<div class="a_background">
            		<div class="a_background_top"></div>
            		<div class="a_background_middle"></div>
            		<div class="a_background_bottom"></div>
            	</div>
                <!-- 云 -->
                <div class="cloudArea">
                    <div class="cloud cloud1"></div>
                    <div class="cloud cloud2"></div>
                </div>
                <!-- 太阳 -->
                <div id="sun"></div>
            </li>
            <!-- 第二副画面 -->
            <li> 
                <!-- 背景图 -->
                <div class="b_background"></div>
                <div class="b_background_preload"></div>
                <!-- 商店 -->
                <div class="shop">
                    <div class="door">
                        <div class="door-left"></div>
                        <div class="door-right"></div>
                    </div>
                    <!-- 灯 -->
                    <div class="lamp"></div>
                </div>
                <!-- 鸟 -->
                <div class="bird"></div>
            </li>
            <!-- 第三副画面 -->
            <li>
                <!-- 背景图 -->
                <div class="c_background">
                    <div class="c_background_top"></div>
                    <div class="c_background_middle"></div>
                    <div class="c_background_bottom"></div>
                </div>
                <!-- 小女孩 -->
                <div class="girl"></div>
                <!-- 水波 -->
                <div class="bridge-bottom">
                    <div class="water">
                        <div id="water1" class="water_1"></div>
                        <div id="water2" class="water_2"></div>
                        <div id="water3" class="water_3"></div>
                        <div id="water4" class="water_4"></div>
                    </div>
                </div>
                <!-- 星星 -->
                <ul class="star">
                    <li class="star1"></li>
                    <li class="star2"></li>
                    <li class="star3"></li>
                    <li class="star4"></li>
                    <li class="star5"></li>
                    <li class="star6"></li>
                </ul>
            </li>
        </ul>
        <div id="boy" class="charector"></div>
    </div>
    <div class="button">
        <button>开始</button>
        <button>暂停</button> 
    </div>
    
    <script type="text/javascript">
        $(function() {
            var container = $("#content");
            var swipe = Swipe(container);
            var visualWidth = container.width();
            // 页面滚动到指定位置
            function scrollTo(time, proportionX) {
                var distX = visualWidth * proportionX;
                swipe.scrollTo(distX, time);
            }

            // 获取数据
            var getValue = function(className) {
                var $elem = $('' + className + '');
                // 走路的
                return {
                    height: $elem.height(),
                    top: $elem.position().top
                }
            }

            // 路的Y轴
            var bridgeY = function() {
                var data = getValue('.c_background_middle');
                return data.top;
            }();

            ////////////////////////////////////
            //===========动画处理=============//
            ////////////////////////////////////
            // 用来临时调整页面
            swipe.scrollTo(visualWidth * 2, 0);

            // 小女孩
            var girl = {
                elem: $('.girl'),
                getHeight: function() {
                    return this.elem.height();
                },
                setOffset: function() {
                    this.elem.css({
                        left: visualWidth / 2,
                        top: bridgeY - this.getHeight()
                    });
                }
            };

            // 修正小女孩的位置
            girl.setOffset();

            // 小孩走路
            var boy = BoyWalk();

            // 右边飞鸟
            var bird = {
                elem: $(".bird"),
                fly: function() {
                    this.elem.addClass('birdFly');
                    this.elem.transition({
                        right:container.width()
                    }, 15000, 'linear');
                }
            }

            function startRun() {
                boy.walkTo(2000, 0.5).then(function() {
                    // 暂停走路
                    boy.stopWalk();
                }).then(function() {
                    // 开门
                    return openDoor();
                }).then(function() {
                    // 开灯
                    lamp.bright();
                }).then(function() {
                    // 走进商店
                    return boy.toShop(2000);
                }).then(function() {
                    // 取花
                    return boy.takeFlower();
                }).then(function() {
                    // 飞鸟
                    bird.fly();
                }).then(function() {
                    // 走出商店
                    return boy.outShop(2000);
                }).then(function() {
                    // 关门
                    return shutDoor();
                }).then(function() {
                    // 灯灭
                    lamp.dark();
                });
            }

            //开始
            $("button:first").click(startRun);
            // 暂停
            $('button:last').click(function() {
                boy.stopWalk();
            });

            // // 开始动画
            // $("button:first").click(function() {
            //     // 太阳公转
            //     $("#sun").addClass('rotation');
            //     // 飘云
            //     $(".cloud:first").addClass('cloud1Anim');
            //     $(".cloud:last").addClass('cloud2Anim');

            //     // 开始第一次走路
            //     boy.walkTo(2000, 0.2).then(function() {
            //         // 第一次走路完成
            //         // 开始页面滚动
            //         scrollTo(5000, 1);
            //     }).then(function() {
            //         // 第二次走路
            //         return boy.walkTo(5000, 0.5);
            //     });
            // });

            // // 暂停
            // $('button:last').click(function() {
            //     boy.stopWalk();
            // });
        });

        
    </script>

    <script type="text/javascript" src="Swipe.js"></script>
    <script type="text/javascript" src="Qixi.js"></script>
</body>

</html>